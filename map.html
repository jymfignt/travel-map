<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆ‘çš„æ—…è¡Œåœ°å›¾</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="data/places.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    }

    #map {
      height: 100vh;
      width: 100%;
    }

    .control-panel {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      min-width: 250px;
    }

    .control-panel h3 {
      margin: 0 0 15px 0;
      font-size: 1.2rem;
      color: #333;
    }

    .year-slider {
      width: 100%;
      margin: 10px 0;
    }

    .year-display {
      font-size: 1.5rem;
      font-weight: bold;
      color: #4c7dfc;
      text-align: center;
      margin: 10px 0;
    }

    .legend {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #ddd;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin: 8px 0;
      font-size: 0.9rem;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 3px;
      margin-right: 10px;
    }

    .legend-point {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid #fff;
      margin-right: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .stats {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #ddd;
      font-size: 0.85rem;
      color: #666;
    }

    input[type=range] {
      width: 100%;
      cursor: pointer;
    }

    .custom-popup {
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    }

    .custom-popup h4 {
      margin: 0 0 8px 0;
      color: #333;
    }

    .custom-popup p {
      margin: 4px 0;
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="control-panel">
    <h3>ğŸŒ æ—…è¡Œæ—¶é—´è½´</h3>
    <div class="year-display" id="year-label">å…¨éƒ¨å¹´ä»½</div>
    <input type="range" class="year-slider" id="year" min="2005" max="2025" value="2005" step="0.1" />
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: rgba(76, 125, 252, 0.4);"></div>
        <span>åŒºåŸŸèŒƒå›´</span>
      </div>
      <div class="legend-item">
        <div class="legend-point" style="background: #ff6b6b;"></div>
        <span>å…·ä½“åœ°ç‚¹</span>
      </div>
    </div>

    <div class="stats">
      <div>æ€»åœ°ç‚¹æ•°: <strong id="total-places">0</strong></div>
      <div>å·²æ˜¾ç¤º: <strong id="visible-places">0</strong></div>
    </div>
  </div>

  <script src="data/places.js"></script>
  <script>
    // åˆå§‹åŒ–åœ°å›¾
    const map = L.map('map').setView([35, 110], 4);

    // æ·»åŠ åœ°å›¾å›¾å±‚
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors',
      maxZoom: 18
    }).addTo(map);

    const markers = [];
    const regions = [];

    // åˆ›å»ºæ ‡è®°å’ŒåŒºåŸŸ
    places.forEach(place => {
      if (place.type === 'point') {
        const marker = L.circleMarker([place.lat, place.lng], {
          radius: 8,
          fillColor: '#ff6b6b',
          color: '#fff',
          weight: 2,
          opacity: 1,
          fillOpacity: 0.8
        });
        
        const popupContent = `
          <div class="custom-popup">
            <h4>${place.name}</h4>
            <p><strong>å¹´ä»½:</strong> ${place.year || 'æœªæ ‡æ³¨'}</p>
            <p><strong>å¤‡æ³¨:</strong> ${place.note}</p>
          </div>
        `;
        marker.bindPopup(popupContent);
        markers.push({ marker, place });
      } else if (place.type === 'region' && place.bounds) {
        const rectangle = L.rectangle(place.bounds, {
          color: '#4c7dfc',
          weight: 2,
          fillColor: '#4c7dfc',
          fillOpacity: 0.3
        });
        
        const popupContent = `
          <div class="custom-popup">
            <h4>${place.name}</h4>
            <p><strong>å¹´ä»½:</strong> ${place.year || 'æœªæ ‡æ³¨'}</p>
            <p><strong>å¤‡æ³¨:</strong> ${place.note}</p>
          </div>
        `;
        rectangle.bindPopup(popupContent);
        regions.push({ rectangle, place });
      }
    });

    // æ›´æ–°æ˜¾ç¤º
    function updateDisplay(year) {
      let visibleCount = 0;
      
      // æ˜¾ç¤º/éšè—ç‚¹æ ‡è®°
      markers.forEach(({ marker, place }) => {
        if (place.year === null || place.year <= year) {
          if (!map.hasLayer(marker)) {
            marker.addTo(map);
          }
          visibleCount++;
        } else {
          if (map.hasLayer(marker)) {
            map.removeLayer(marker);
          }
        }
      });

      // æ˜¾ç¤º/éšè—åŒºåŸŸ
      regions.forEach(({ rectangle, place }) => {
        if (place.year === null || place.year <= year) {
          if (!map.hasLayer(rectangle)) {
            rectangle.addTo(map);
          }
          visibleCount++;
        } else {
          if (map.hasLayer(rectangle)) {
            map.removeLayer(rectangle);
          }
        }
      });

      document.getElementById('visible-places').textContent = visibleCount;
    }

    // å¹´ä»½æ»‘å—
    const slider = document.getElementById('year');
    const label = document.getElementById('year-label');

    slider.addEventListener('input', () => {
      const year = parseFloat(slider.value);
      label.textContent = year.toFixed(1);
      updateDisplay(year);
    });

    // åˆå§‹åŒ–æ˜¾ç¤º
    document.getElementById('total-places').textContent = places.length;
    updateDisplay(2025);
    slider.value = 2025;
    label.textContent = '2025.0';
  </script>
</body>
</html>
